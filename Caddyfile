# ====================================
# Caddy 配置文件 - 自动签名证书
# 作用：内网 HTTPS 部署康复治疗记录系统 H5 版本
# ====================================

# 全局配置：禁用自动 HTTPS（因为使用 IP 地址）
{
	auto_https off
	servers {
		protocols h1 h2
	}
}

# 监听 HTTPS 端口 8443
:8443 {
	# 使用之前生成的自签名证书
	tls C:\Users\youda\Desktop\new\mobile-frontend\certs\192.168.10.5-cert.pem C:\Users\youda\Desktop\new\mobile-frontend\certs\192.168.10.5-key.pem

	# 网站根目录
	root * C:\Users\youda\Desktop\new\mobile-frontend\dist\build\h5

	# 静态资源缓存（图片、字体、CSS、JS 缓存 7 天）
	@static {
		path *.jpg *.jpeg *.png *.gif *.ico *.svg *.woff *.woff2 *.css *.js
	}
	header @static Cache-Control "public, max-age=604800"

	# 先尝试直接提供文件
	@hasFile {
		file {path}
	}
	handle @hasFile {
		file_server
	}

	# 如果文件不存在，重定向到 index.html（SPA 路由）
	@noFile {
		not file
	}
	handle @noFile {
		rewrite * /index.html
		file_server
	}

	# 启用 gzip 压缩
	encode gzip
}
