# 患者二维码功能使用指南

## 功能概述

患者二维码功能允许医护人员快速生成包含患者信息的二维码,通过扫描二维码即可在移动端创建治疗记录,无需手动输入患者信息。

---

## PC端使用说明

### 生成二维码

#### 1. 进入患者管理
1. 登录Web管理端
2. 点击左侧菜单"患者管理"
3. 切换到"在院患者"标签页

#### 2. 生成二维码
1. 找到目标患者
2. 点击操作栏中的"二维码"按钮
3. 系统自动生成二维码

#### 3. 选择尺寸
- 默认尺寸:**3cm**(推荐)
- 可选尺寸:1.5cm、2cm、3cm、4cm、5cm
- 点击对应选项即可切换

### 下载二维码

1. 在二维码对话框中点击"下载"按钮
2. 二维码图片将保存到浏览器默认下载目录
3. 文件名格式:`{患者姓名}_{病历号}_qrcode.png`

**使用场景:**
- 发送到手机
- 插入文档
- 保存备用

### 复制二维码

1. 在二维码对话框中点击"复制"按钮
2. 二维码已复制到剪贴板
3. 可以直接粘贴到其他应用(Word、PPT、聊天软件等)

**注意事项:**
- 部分浏览器不支持复制功能,请使用下载功能替代
- 建议使用Chrome、Edge等现代浏览器

### 打印二维码

1. 准备打印机和打印纸
2. 在二维码对话框中点击"打印"按钮
3. 在浏览器打印对话框中选择打印机
4. 调整打印设置(建议选择高质量打印)
5. 点击"打印"

**打印设置建议:**
- 纸张类型:普通A4纸
- 打印质量:高
- 颜色:黑白或彩色均可
- 布局:默认(居中)

**使用场景:**
- 打印后粘贴在病历本上
- 打印后贴在治疗单上
- 制作患者卡片

---

## 移动端使用说明

### 扫码创建治疗记录

#### 1. 打开扫码工具
- 微信扫一扫
- 系统相机扫码
- 其他扫码App

#### 2. 扫描二维码
1. 对准二维码扫描
2. 系统自动识别URL

#### 3. 跳转到创建记录页面
1. 点击识别的URL
2. 自动打开创建治疗记录页面
3. 患者信息自动填充

#### 4. 完成治疗记录
1. 选择治疗项目
2. 选择治疗师
3. 设置治疗时间
4. 提交记录

### 手动输入方式

如果无法扫码,也可以手动输入:

1. 在移动端打开创建治疗记录页面
2. 输入患者的病历号
3. 系统自动查询并填充信息

---

## 常见问题

### Q1: 为什么"二维码"按钮是灰色禁用状态?

**A:** 该患者的病历号缺失,请先编辑患者信息,补充病历号后再生成二维码。

### Q2: 扫码后提示"未找到该患者"?

**A:** 可能的原因:
- 病历号输入错误
- 该患者已被删除
- 网络连接问题

**解决方法:**检查病历号是否正确,或手动在系统中查找该患者。

### Q3: 扫码后提示"该患者已出院"?

**A:** 该患者已经办理出院手续,无法创建新的治疗记录。如需继续治疗,请重新办理入院。

### Q4: 复制功能不可用?

**A:** 复制功能需要浏览器支持Clipboard API:
- 推荐使用Chrome、Edge等现代浏览器
- 确保在HTTPS环境下访问
- 或使用"下载"功能替代

### Q5: 打印的二维码不清晰?

**A:** 调整打印设置:
- 选择更大的尺寸(4cm或5cm)
- 提高打印质量设置
- 使用专用打印纸

### Q6: 二维码生成失败?

**A:** 可能的原因:
- 网络连接问题
- 浏览器兼容性问题

**解决方法:**
- 刷新页面重试
- 更换浏览器(推荐Chrome)
- 检查控制台错误信息

### Q7: 扫码后无法打开页面?

**A:** 请检查:
1. 移动端H5服务是否正常运行
2. 扫描的URL是否完整
3. 网络连接是否正常
4. 手机浏览器是否支持

### Q8: 二维码可以重复使用吗?

**A:** 可以。二维码包含的是病历号信息,只要患者未出院,可以多次扫描使用。

---

## 技术支持

如遇其他问题,请联系技术支持团队,并提供:
- 操作步骤截图
- 浏览器版本信息
- 错误提示信息

---

## 最佳实践

### 推荐工作流程

#### 1. 患者入院时
1. 完善患者信息(确保病历号正确)
2. 生成二维码(推荐3cm尺寸)
3. 打印并粘贴在病历本上

#### 2. 日常治疗
1. 使用手机扫描病历本上的二维码
2. 快速创建治疗记录
3. 节省输入时间

#### 3. 患者出院时
1. 可以保留二维码作为记录
2. 或重新扫码查看历史记录

### 尺寸选择建议

| 尺寸 | 适用场景 |
|------|----------|
| **1.5cm** | 适合数字化传输(微信、邮件) |
| **2cm** | 适合粘贴在小卡片上 |
| **3cm** | **推荐,打印和扫码都方便** |
| **4cm** | 适合打印在A4纸或大型卡片上 |
| **5cm** | 适合远距离扫码或特殊需求 |

### 打印建议

1. 使用高质量打印模式
2. 建议尺寸≥3cm以确保清晰
3. 避免使用劣质打印纸
4. 打印后检查二维码是否清晰完整

### 扫码技巧

1. 确保光线充足
2. 保持二维码平整
3. 避免反光和阴影
4. 距离二维码10-20cm扫码

---

## 功能特性

### PC端功能
- ✅ 二维码实时生成(5种尺寸)
- ✅ 患者姓名显示
- ✅ 下载PNG图片
- ✅ 复制到剪贴板
- ✅ 浏览器打印
- ✅ 防抖优化(200ms)
- ✅ 智能缓存

### 移动端功能
- ✅ 扫码自动跳转
- ✅ 患者信息自动加载
- ✅ 友好的加载提示
- ✅ 完善的错误处理
- ✅ 失败自动返回

### 性能优化
- ⚡ 二维码生成 < 500ms
- ⚡ 缓存加载 < 100ms
- ⚡ 防抖减少频繁生成
- ⚡ 支持跨会话缓存复用

---

## 系统要求

### PC端
- **浏览器:** Chrome 90+、Edge 90+、Firefox 88+、Safari 14+
- **网络:** 需要访问管理端服务器
- **权限:** 患者管理权限

### 移动端
- **平台:** H5浏览器
- **网络:** 需要访问后端API和H5服务
- **扫码:** 支持URL识别的扫码工具

---

## 配置说明

### 环境变量配置

**开发环境** (`web-admin/.env.local`):
```env
# 移动端H5地址
VITE_MOBILE_H5_URL=http://localhost:5173
```

**生产环境**:
```env
# 移动端H5生产地址
VITE_MOBILE_H5_URL=https://yourdomain.com/mobile
```

### 二维码URL格式

**H5应用(当前配置):**
```
http://localhost:5173/#/pages/record/create?medicalNo=2024001
```

**生产环境:**
```
https://yourdomain.com/mobile/#/pages/record/create?medicalNo=2024001
```

---

## 数据安全

### 隐私保护
- 二维码仅包含病历号
- 不包含敏感个人信息
- 需要登录才能访问

### 访问控制
- 移动端需要登录认证
- API需要JWT token
- 患者信息权限验证

### 数据传输
- 使用HTTPS加密传输
- Token有效期控制
- 自动token刷新

---

## 更新日志

**v1.0.0** (2025-01-18)
- ✅ 首次发布患者二维码功能
- ✅ 支持5种尺寸选择
- ✅ 支持下载、复制、打印功能
- ✅ 移动端扫码自动填充患者信息
- ✅ H5应用完整支持
- ✅ 性能优化(防抖、缓存)

---

## 附录

### 快捷键

| 操作 | 快捷键 |
|------|--------|
| 打印 | Ctrl + P (Windows)<br>Cmd + P (Mac) |
| 保存 | Ctrl + S (Windows)<br>Cmd + S (Mac) |
| 刷新 | F5 或 Ctrl + R |

### 键盘导航

- `Tab`: 切换焦点
- `Enter`: 确认操作
- `Esc`: 关闭对话框

---

**文档版本:** v1.0.0
**最后更新:** 2025-01-18
**维护团队:** 技术支持团队
