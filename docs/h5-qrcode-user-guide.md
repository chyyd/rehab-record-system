# H5扫码功能使用指南

## 功能概述

H5扫码功能允许医护人员通过手机浏览器直接扫描患者二维码，快速创建治疗记录，无需手动输入患者信息。

---

## 环境要求

### 设备要求
- Android手机：Chrome 90+ 浏览器
- iPhone/iPad：Safari 11+ 浏览器
- 摄像头功能正常

### 网络要求
- 手机和医院服务器在同一内网
- WiFi连接稳定
- 可以访问内网IP地址

---

## 首次使用配置

### Android设备（Chrome浏览器）

#### 步骤1：访问H5应用

1. 打开Chrome浏览器
2. 在地址栏输入：`https://192.168.10.5:5173`
3. 按回车访问

#### 步骤2：处理安全证书警告

首次访问会看到"您的连接不是私密连接"警告：

1. 点击页面下方的"ADVANCED"按钮
2. 点击"Proceed to 192.168.10.5 (unsafe)"链接
3. 页面加载成功

**注意：** 这是正常的，因为我们使用的是内网自签名证书。数据在内网传输，仍然是安全的。

#### 步骤3：允许摄像头权限

1. 进入扫码页面
2. 点击"允许使用摄像头"按钮
3. 浏览器弹出权限请求对话框
4. 点击"允许"按钮

#### 步骤4：开始扫码

摄像头预览出现后，将二维码对准摄像头即可自动识别。

---

### iOS设备（Safari浏览器）

#### 步骤1：访问H5应用

1. 打开Safari浏览器
2. 在地址栏输入：`https://192.168.10.5:5173`
3. 按回车访问

#### 步骤2：信任安全证书

首次访问会看到安全警告：

1. 点击页面中间的"详情"按钮
2. 点击"访问此网站"链接
3. 页面加载后，点击地址栏的锁图标🔒
4. 点击"证书信息"
5. 滚动到底部，找到"信任"部分
6. 点击"信任此证书"

#### 步骤3：刷新页面

1. 完全关闭Safari（从后台关闭）
2. 重新打开Safari
3. 再次访问 `https://192.168.10.5:5173`
4. 现在应该不会看到警告了

#### 步骤4：允许摄像头权限

1. 进入扫码页面
2. 点击"允许使用摄像头"按钮
3. Safari弹出权限请求对话框
4. 点击"允许"按钮

#### 步骤5：开始扫码

摄像头预览出现后，将二维码对准摄像头即可自动识别。

---

## 日常使用

### 快速扫码流程

1. 打开手机浏览器（Chrome或Safari）
2. 访问 `https://192.168.10.5:5173`
3. 进入扫码页面
4. 将患者二维码对准摄像头
5. 听到提示音后自动跳转
6. 治疗记录页面已自动填充患者信息
7. 完成治疗记录创建

### 扫码技巧

**最佳距离：** 保持手机距离二维码20-30厘米

**光线要求：** 确保光线充足，避免反光

**角度调整：** 二维码尽量对准摄像头中心，可以适当倾斜

**对焦：** 等待摄像头对焦清晰后再进行扫描

**稳定：** 保持手机稳定，避免抖动

---

## 功能说明

### 扫码界面

```
┌─────────────────────────────┐
│                             │
│  ┌─────────────────────┐   │
│  │     扫描框          │   │
│  │   [绿色边框]        │   │
│  │                     │   │
│  │   [扫描线上下移动]   │   │
│  └─────────────────────┘   │
│                             │
│   将二维码放入框内          │
│                             │
│  [停止码] [切换摄像头]       │
└─────────────────────────────┘
```

### 控制按钮

**停止扫码：** 点击后停止摄像头预览，节省电量

**切换摄像头：**
- 后置摄像头：扫描实物二维码（推荐）
- 前置摄像头：扫描屏幕上的二维码

### 状态提示

**扫码成功：**
- 手机震动（如果支持）
- 播放"滴"提示音
- 自动跳转到治疗记录页面

**扫码失败：**
- 显示错误提示信息
- 检查二维码是否清晰
- 调整距离和光线后重试

---

## 常见问题

### Q1: 无法访问HTTPS网站

**问题：** 浏览器显示"您的连接不是私密连接"

**解决方案：**
1. **Android Chrome：** 点击"ADVANCED" → "Proceed to..."
2. **iOS Safari：** 按照上述步骤信任证书
3. 确认输入的IP地址正确：`https://192.168.10.5:5173`

### Q2: 摄像头无法启动

**问题：** 点击"允许使用摄像头"后，没有预览画面

**可能原因：**
1. 浏览器未授予摄像头权限
2. 摄像头被其他应用占用
3. 摄像头硬件故障

**解决方案：**
1. 检查浏览器权限设置
2. 关闭其他使用摄像头的应用
3. 重启浏览器
4. 检查手机摄像头是否正常

### Q3: 扫码不识别

**问题：** 二维码对准摄像头后无法识别

**可能原因：**
1. 距离太近或太远
2. 光线不足
3. 二维码模糊或反光
4. 二维码太小

**解决方案：**
1. 调整距离到20-30厘米
2. 确保光线充足
3. 避免二维码反光
4. 等待摄像头对焦清晰
5. 使用PC端生成的较大尺寸二维码（3cm或4cm）

### Q4: iOS无法信任证书

**问题：** 按照步骤操作后，仍然显示证书警告

**解决方案：**
1. 完全关闭Safari（双击Home键，上滑关闭）
2. 重新打开Safari
3. 访问 `https://192.168.10.5:5173`
4. 重复信任证书步骤
5. 如果还不行，重启手机后再试

### Q5: 识别速度慢

**问题：** 扫描后需要等几秒才识别

**解决方案：**
1. 确保光线充足
2. 保持二维码稳定
3. 调整距离和角度
4. 等待摄像头对焦清晰

### Q6: 扫码后未跳转

**问题：** 扫码成功但没有跳转到治疗记录页面

**可能原因：**
1. 二维码格式不正确
2. 网络连接问题
3. 页面加载失败

**解决方案：**
1. 确认扫描的是患者二维码
2. 检查网络连接
3. 刷新页面重试
4. 联系技术支持

---

## 安全提示

### 证书安全

- ⚠️ 这是内网自签名证书，仅在本地网络使用
- ✅ 数据不会传输到外网
- ✅ 患者信息在内网传输，安全可控

### 隐私保护

- 摄像头仅在扫码时使用
- 扫码结束后自动关闭摄像头
- 不会存储任何摄像头画面

### 网络安全

- 仅在医院内网使用
- 不要将访问地址分享到外网
- 定期更换WiFi密码

---

## 技术支持

### 遇到问题？

如果您在使用过程中遇到任何问题，请联系技术支持团队：

**内网电话：** XXXX-XXXX

**工作时间：** 周一至周五 8:00-17:00

**提供以下信息可以获得更快帮助：**
1. 手机型号和操作系统版本
2. 浏览器类型和版本
3. 具体的错误提示或问题描述
4. 问题发生的操作步骤

---

## 更新日志

**v1.0.0** (2025-01-18)
- 首次发布H5扫码功能
- 支持Android和iOS设备
- 支持内网HTTPS访问
- 支持患者二维码扫描
- 支持自动跳转治疗记录

---

## 附录

### 支持的浏览器

| 平台 | 浏览器 | 最低版本 | 状态 |
|------|--------|----------|------|
| Android | Chrome | 90 | ✅ 完全支持 |
| Android | Firefox | 90 | ✅ 完全支持 |
| Android | Samsung Internet | 14 | ✅ 完全支持 |
| iOS | Safari | 11 | ✅ 完全支持 |
| iOS | Chrome | 90 | ✅ 完全支持 |
| 微信 | 微信内置浏览器 | - | ❌ 不支持 |

### 不支持的浏览器

**微信内置浏览器：** 微信浏览器不支持摄像头API，无法使用H5扫码功能。

**解决方案：** 使用系统浏览器（Chrome或Safari）访问

### 快捷方式

**添加到主屏幕（iOS）：**
1. 访问 H5 应用
2. 点击分享按钮
3. 选择"添加到主屏幕"
4. 下次可以直接点击图标打开

**添加到书签（Android）：**
1. 访问 H5 应用
2. 点击菜单按钮（三个点）
3. 选择"添加书签"
4. 保存在桌面或书签栏
